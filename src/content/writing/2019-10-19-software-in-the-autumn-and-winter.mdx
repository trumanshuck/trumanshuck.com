---
title: 'Software in the Autumn and Winter'
published: '2019-10-19'
tags: ['ideas about technology']
preview: [
  "A system of software that grows unceasingly",
  "becomes gnarled by past decisions;",
  "it must be allowed to succumb to a winter frost",
  "so that it may flourish anew in the spring."
]
---

import { Box, Text, Link } from 'rebass'
import { Icon, Footnote } from '../../components'
import OrigamiSquirrelFilled from '../../images/origami-squirrel-filled.svg'
import OrigamiSquirrelOutline from '../../images/origami-squirrel-outline.svg'

<Box fontSize={3}>

#### A Sentence

A system that grows unceasingly becomes gnarled by past decisions; it must be allowed to succumb to a winter frost so that it may flourish anew in the spring.

<Box display="flex" alignItems="center" justifyContent="center">
  <Icon icon={OrigamiSquirrelOutline} color="muted" size={6} />
</Box>

#### A Paragraph

I have a new metaphor: a well-worked codebase is like a tangled summer garden. My company's _Rules Engine_, in particular, has come to feel _wild_. It is a useful system, and we've taken a responsible, refactoring approach to extending it -- but the constricting vines of past decisions feel tight around us. To allow the garden perpetual growth may feel safer, but it is better to reap our harvest and to tend something new in the spring.

<Box display="flex" alignItems="center" justifyContent="center">
  <Icon icon={OrigamiSquirrelOutline} color="muted" size={6} />
  <Icon icon={OrigamiSquirrelOutline} color="muted" size={6} />
</Box>

#### A Page

There are as many personal metaphors about writing software as there are people who write software. To say that programming lends itself to metaphor isn't quite right; software _demands_ metaphor. I type with my hands, but everything I create is intangible and imaginary. The only way to talk about it, or to reason about it, is in a language-by-proxy. Otherwise it doesn't really exist<Footnote id="foot-1" href="#1">1</Footnote>. So writing software is a recipe, or a blueprint, or a polymorphic mammal that quacks or barks.

It might be that the creation of a metaphor is one of those cobbles on the path from novice to less-novice, and so I'm offering my own<Footnote id="foot-2" href="#2">2</Footnote>. It has to do with gardening, although I'm really no great gardener: my partner is generally the one to maintain our planters of parsley and cilantro, and I still get confused between the two. So this will be as maladaptive as any metaphor.

It's not about cultivating code, or about pruning technical debt. It's not features as flowers<Footnote id="foot-3" href="#3">3</Footnote>. I'm concerned with the later seasons: as we find ourselves in the autumn and eventually the winter. What does it mean to harvest, to care for the soil, and to spend time reflecting while the ground is hard and little grows. What does it mean to reap knowledge of our domain, to maintain clear and coherent systems, and to use that understanding to continuing growing ever more complex products.

How do we allow the ground to lie fallow, how do we plan to grow again in the spring.

<Box display="flex" alignItems="center" justifyContent="center">
  <Icon icon={OrigamiSquirrelOutline} color="muted" size={6} />
  <Icon icon={OrigamiSquirrelOutline} color="muted" size={6} />
  <Icon icon={OrigamiSquirrelOutline} color="muted" size={6} />
</Box>

I work at _Hatch Loyalty_, building a platform with which other, much larger, businesses run their various loyalty programs. At the heart of the platform is our Rules Engine, a <Link href="https://martinfowler.com/bliki/RulesEngine.html" target="_blank" color="muted">production rule system</Link> that allows abstract marketing strategies to be translated into functional sets of actions and effects. The Engine was newly sprouted when I joined the company in 2016. It has continued to bloom.

In the beginning, the _Rules Engine_ was a (relatively) simple system that examined _events_ and emitted _effects_: someone purchases "Muscle Milk" and is issued points<Footnote id="foot-4" href="#4">4</Footnote>. It's grown to support a variety of preconditions, to enable demographic- and behavior-based targeting, and to enforce various limitations on how frequently someone engages with a particular promotion. With each addition we've done our best to keep the _Engine_ modular and extensible; I work with an astoundingly thoughtful group of folks. This has resulted in something that is coherent, but that has begun to feel like a bramble of blackberries. There is fruit in that thicket; it's mixed with thorns and dead wood.

We've refactored and rearchitected. We've rewritten subsections. We've renamed modules to better fit their responsibilities. The _Engine_ has been cultivated as well as we know how: part by part as we've come to better understand the product that we're tending<Footnote id="foot-5" href="#5">5</Footnote>. But we are still broadly constrained by a system that is under constant use and frequent development. Our past decisions are vines that wind throughout our code. The _Engine_, today, feels _wild_.

<Box display="flex" alignItems="center" justifyContent="center">
  <Icon icon={OrigamiSquirrelOutline} color="accent" size={6} />
  <Icon icon={OrigamiSquirrelOutline} color="accent" size={6} />
  <Icon icon={OrigamiSquirrelOutline} color="accent" size={6} />
</Box>

Two years ago my partner and I planted basil in a black plastic pot in our first balcony garden. It grew, but was stunted and withered before the summer was over. We moved, tried again in the following spring, and killed a second plant. It was late in the second summer when we realized that basil may not appreciate having its roots burned by the dark pot and the hot sun. But, our other balcony boxes were flourishing with flowers and thyme and mint and oregano. We could have tried a mid-season transplant, but the other herbs might have been shocked at being uprooted. And anyway it would have made a mess on the deck.

We have fundamental improvements to make to our _Rules Engine_. The _Engine_ executes asynchronously as a background job, and we'd like it to execute synchronously: this means that performance is a greater concern. We'd like its processing to be more observable, and we'd like it to be idempotent<Footnote id="foot-6" href="#6">6</Footnote>. These improvements require foundational changes to the _Rules Engine_. Our foundation is a creeping briar of past decisions. I don't believe that there is a better way to build software<Footnote id="foot-7" href="#7">7</Footnote>, and yet we feel constricted. It is difficult to encourage systemic growth when surveying the state of _what is_ introduces a myopic filter on _what can be_. Every choice we've made, every module we've built, has lead us to product that is subtly, intractably, entangled.

I think about crop rotation, about letting a field lay fallow and allowing <Link href="https://www.sare.org/Learning-Center/Books/Crop-Rotation-on-Organic-Farms/Text-Version/Physical-and-Biological-Processes-In-Crop-Production/Crop-Rotation-Effects-on-Soil-Fertility-and-Plant-Nutrition" target="_blank" color="muted">dirt to again become soil</Link>. I think about this past spring, and about how easy it was to find a new home for our basil after the Chicago winter had wiped away our porch garden. I want to harvest what we've learned about loyalty programs, about software, and about our _Rules Engine_, and to write it again. To grow it from seed in good soil.

There are <Link href="https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/" target="_blank" color="muted">risks</Link>, and there are preconditions. Our _Engine_ is working well, and there are no time-sensitive new requirements on the horizon. We must be able to bet that work on this piece of our platform might remain dormant for a while; that it will continue to work and to yield value. I have some thoughts on tactics and strategy; I'm looking forward to sharpening those tools with the folks that I work with. And I'm looking forward to writing about that process in the future.

I do not get to choose when the Chicago winter sets in, and I am given no say in my basil's last leaves. But we have to make a deliberate decision on when to gather the fruits of our work and replant. It's often easier to sell -- to ourselves and to the business we work in -- the idea of an eternal growing season. I do not believe that it's an honest idea: our soil eventually turns to dirt if untended, and our foundation eventually erodes away.

This is not about starting from scratch; it's about beginning again with more perspective. I do not think it is so daunting. And there is something in the clear, brisk air that forces me to become alive. And there is something exciting in the coming spring.

Thank you for your time and for your attention.

<Box display="flex" alignItems="center" justifyContent="center">
  <Icon icon={OrigamiSquirrelFilled} color="accent" size={6} />
  <Icon icon={OrigamiSquirrelFilled} color="accent" size={6} />
  <Icon icon={OrigamiSquirrelFilled} color="accent" size={6} />
</Box>

#### An Addendum

Tactically it's incredibly important that we have integration tests outside of the _Engine_ that we propose to renew. It's important to be able to draw thick lines around the interfaces in to and out of this part of our system. It's important to take a good few leaps into the sky, to look down at our existing garden, and to use all of the understanding we've developed to lay it out afresh.

I think that Basecamp's ideas on <Link href="https://basecamp.com/shapeup/4.2-appendix-03#new-versus-existing-products" target="_blank" color="muted">new products</Link> fit with this process. I have a feeling that they've done something similar to this when creating Basecamp 3, and might again as they write Basecamp 4 -- but I don't have any real details on that. I'm hopeful about a winter for our _Rules Engine_, but we have not yet embarked.

<Box as="hr" my={4} bg="hr" height="2px" sx={{ border: 'none' }} />

<Text color="muted" id="1" mb={2}>
  <Link href="#foot-1" color="accent">
    1:
  </Link>{' '}
  To be pedantic -- and I am, enough to write a footnote -- software does exist in the small magnetic fields on a hard disk. Or whatever state change allows solid-state drives to work. It exists while electricity is flowing through tiny semiconductors, and in whatever other physical manifestations a computer has.

But I can only ever see what I've done through a screen. I can only feel connected to what I do by talking about it. Maybe the feeling is different for folks writing software in robotics. They program "jump." Their creation asks its magnetic brain: "how many bits high?"

</Text>

<Text color="muted" id="2" mb={2}>
  <Link href="#foot-2" color="accent">
    2:
  </Link>{' '}
  No one achieves anything alone. I've been kicking this idea around with other folks at <i>Hatch</i>, any of whom have as much claim to
  write their own post. As long as they cite me, similarly vaguely, in a footnote.
</Text>

<Text color="muted" id="3" mb={2}>
  <Link href="#foot-3" color="accent">
    3:
  </Link>{' '}
  <Link href="https://blog.codinghorror.com/tending-your-software-garden/" target="_blank" color="muted">
    One of many other writings on the subject.
  </Link>
</Text>

<Text color="muted" id="4" mb={2}>
  <Link href="#foot-4" color="accent">
    4:
  </Link>{' '}
  And presumably muscles.
</Text>

<Text color="muted" id="5" mb={2}>
  <Link href="#foot-5" color="accent">
    5:
  </Link>{' '}
  To return briefly from metaphor, our first iteration of limiting engagement with a promotion (<i>maximum 5 uses per customer</i>), used a model that we called a "Tracker." The Tracker was responsible both for recording the fulfillment of a promotion, as well as optionally enforcing limitation. This worked, but eventually it became apparent that these were two very separate responsibilities.

It's important to <i>track</i> all promotions, but only a portion require <i>limitation</i>. This meant that we had to explicitly attach a "Tracker" to every promotion regardless of the desire to limit, which began to needlessly complicate our system. We refactored the orchestration of the <i>Engine</i> to remove the need to add an explicit "Tracker." We allowed the <i>Engine</i> to track engagement implicitly. This meant the addition of an optional model, the "Limiter", the root-and-stem removal of the "Tracker," and some data-backfills to put everything back in order. The Limiter's responsibilities, and name, now made sense. Our system was a little bit clearer.

</Text>

<Text color="muted" id="6" mb={2}>
  <Link href="#foot-6" color="accent">
    6:
  </Link>{' '}
  We use Sidekiq and have run in to a very small but measurable number of jobs that execute{' '}
  <Link
    href="https://github.com/mperham/sidekiq/wiki/FAQ#what-happens-to-long-running-jobs-when-sidekiq-restarts"
    target="_blank"
    color="muted"
  >
    twice
  </Link>
  .
</Text>

<Text color="muted" id="6" mb={2}>
  <Link href="#foot-6" color="accent">
    7:
  </Link>{' '}
  Grand plans <Link href="http://agilemanifesto.org" target="_blank" color="muted">don't work</Link>. We begin building software when we <i>know</i> the least and <i>assume</i> the most. We know the most about our plants after they've grown, and the most about our products after they're built.
</Text>
</Box>
